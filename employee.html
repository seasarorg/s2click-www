<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja"><head><!-- don't edit start --><title>S2Click-Employee</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><link href="s2click.css" type="text/css" rel="stylesheet" media="screen" /><link href="seasar_b.css" type="text/css" rel="stylesheet" media="screen" /><link href="seasar_p.css" type="text/css" rel="stylesheet" media="print" /><script src="seasar_b.js" type="text/JavaScript" language="JavaScript">
</script></head>
<body style="direction: ltr;" onload="preload('ja')"><table align="left" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" valign="top" width="780"><table class="white" border="0" cellpadding="0" cellspacing="0" width="780">
<tbody><tr><td colspan="7"><img src="images/top01_b.gif" alt="" height="5" width="780" /></td></tr><tr><td><img src="images/top02_b.gif" alt="Seasar" height="117" width="235" /></td><td colspan="3"><img src="images/top03.gif" alt="DI Container with AOP" height="117" width="289" /></td><td colspan="3"><img src="images/spacer.gif" alt="" height="117" width="256" /></td></tr><tr><td rowspan="2"><img src="images/top04.gif" alt="" height="49" width="235" /></td><td><a href="http://www.seasar.org/index.html"><img src="images/menu01_b_ja.gif" alt="" id="menu01" onmouseover="swap(1)" onmouseout="restore(1)" name="menu01" border="0" height="30" width="78" /></a></td><td><a href="http://www.seasar.org/projects.html"><img src="images/menu02_b_ja.gif" alt="" id="menu02" onmouseover="swap(2)" onmouseout="restore(2)" name="menu02" border="0" height="30" width="101" /></a></td><td><a href="http://www.seasar.org/products.html"><img src="images/menu03_b_ja.gif" alt="" id="menu03" onmouseover="swap(3)" onmouseout="restore(3)" name="menu03" border="0" height="30" width="110" /></a></td><td><a href="http://www.seasar.org/resources.html"><img src="images/menu04_b_ja.gif" alt="" id="menu04" onmouseover="swap(4)" onmouseout="restore(4)" name="menu04" border="0" height="30" width="113" /></a></td><td><img src="images/menu05_b_ja.gif" alt="" id="menu05" onmouseover="swap(5)" onmouseout="restore(5)" name="menu05" border="0" height="30" width="109" /></td><td><img src="images/menu06.gif" alt="" height="30" width="34" /></td>
</tr><tr><td colspan="6"><img src="images/spacer.gif" alt="" height="19" width="545" /></td></tr></tbody></table><table class="white" border="0" cellpadding="0" cellspacing="0" width="780"><tbody><tr align="left" valign="top"><td width="14"><img src="images/spacer.gif" alt="" height="14" width="14" /></td><td class="main" width="740"><!-- don't edit end --><!-- document start -->
<dl>
<dd>&nbsp;</dd>

<h3><a name="document" id="document">Employee
</a></h3>
</dl>

<dl>
<dd>それでは、S2JSF ExampleのEmployeeを少し変形した、S2Click版 Employeeサンプルを見てみましょう</dd>
</dl>

<dl>
<dd>最初に表示されるのは、下記の様な検索条件設定画面です。また新たなレコードの追加の場合は、「新規」ボタンをおすことで、Edit画面を開く事ができます。</dd>
</dl>

<dl>
<dd>またこの検索条件のDtoは、Sessionに保存されますので、この画面を再度開くと前回の条件が表示されますので、それらの条件を消す場合は「消去」ボタンをおすことで、ブラウザのJava Scriptで消すことが出来ます。</dd>
</dl>
<img src="images/employee_search.jpeg" />
<dl>
<dd>このページもAdd2 Exampleと同様にFormに表示するTableのColumnを設定しており、この場合は２に設定してあります。/dd>
</dl>

<dl>
<dd>この画面に条件を入力後「検索」ボタンをおすと、画面の条件をDtoに設定して、そのDtoをSessionに保存後<a href="employee_list.html">List画面</a>にRedirectします。</dd>
</dl>

<dl>
<dd>それでは、S2Clickの最初のページでも紹介しましたが、Managerの検索をGreyBoxを使用して行うのを容易にする、TextFieldSelectId　Controlについて説明します。これは、検索した結果のIdとTextを同時に取得するもので、Textのみ取得する　TextFieldSelect　ControlをExtendしています。</dd>
</dl>

<dl>
<dd>TextFieldSelectの ソースコードは下記の通りです。</dd>
</dl>
<!--code start-->
<div class="excode"><pre>
<code>
public class TextFieldSelect  extends TextField {
    protected static final String HTML_IMPORTS =
        "&lt;link type=\"text/css\" rel=\"stylesheet\" href=\"{0}/click/greybox/greybox.css\"/&gt; \n"
        + "&lt;script type=\"text/javascript\" src=\"{0}/click/greybox/AJS_compressed.js\"&gt; &lt;/script&gt; \n"
        + "&lt;script type=\"text/javascript\" src=\"{0}/click/greybox/greybox_compressed.js\"&gt; &lt;/script&gt; \n"
        + "&lt;script type=\"text/javascript\" src=\"{0}/click/greybox/setfields.js\"&gt; &lt;/script&gt; \n";
    protected static final String[] GREYBOX_RESOURCES =
    { "AJS_compressed.js", "blank.gif", "blank.html", "close.gif",
      "greybox_compressed.js", "greybox_nav_compressed.js", "greybox.css",
      "header_bg.gif", "indicator.gif", "loader_frame.html", 
      "next.gif", "overlay_dark.png", "overlay_light.png", "prev.gif",
      "edit-button.gif"};
	protected Image image = new Image();
	public TextFieldSelect(){
		
	}
	TextFieldSelect(String name, boolean required){
		super(name, required);
	}
    public TextFieldSelect(String name, String label) {
        super(name, label);
    }
    public TextFieldSelect(String name, String label, boolean required) {
        super(name, label,required);
    }
    public TextFieldSelect(String name, String label, int size) {
        super(name, label, size);
    }

	public void setImageSrc(String src) {
		 image.setSrc(src);
	}
	public void setSelectPage(String windowTitle, String path)
	{
		image.setAttribute("onclick","S2C_SHOW_URL('"+getId()+"','"+"windowTitle"+"','"+ path + "')");
	}
	@Override
	public String toString() {
		Utility.copyGrayboxJs(getForm().getContext());
		return super.toString() + imageToString();
	}
	private String imageToString(){
		if (image.getName()==null){
			image.setName(getName()+"_s2img");
		}
		if (image.getSrc() == null){
			image.setSrc(getContext().getRequest().getContextPath()+
					"/click/greybox/edit-button.gif");
		}
		return image.toString();
	}
    public void onDeploy(ServletContext servletContext) {
        for (int i = 0; i &lt; GREYBOX_RESOURCES.length; i++) {
            String greyboxFilename = GREYBOX_RESOURCES[i];
            String greyboxResource =
                "/org/seasar/s2click/control/greybox/" + greyboxFilename;

            ClickUtils.deployFile(servletContext,
                                  greyboxResource,
                                  "click/greybox");
        }
        Utility.removeGrayboxJs(servletContext);    
    }
    public String getHtmlImports() {
        String[] args = {
            getContext().getRequest().getContextPath()
        };
        return MessageFormat.format(HTML_IMPORTS, args);
    }
}

</code>
</pre></div>
<!--code end-->
<dl>
<dd>Click.xmlの「コントロール」定義をしておくことにより、Click Servlet起動時にOnDeploy Methodが呼ばれますので、ここで、JavaScript Fileを clickのフォルダーにコピーします。但し既に同名のファイルがある場合は上書きされませんので、TESTの場合など設定内容を変更した場合は、clickのフォルダー毎削除するか、当該ファイルを削除しないと変更が有効になりません。</dd>
</dl>

<dl>
<dd>また、HTML_IMPORTSに設定した内容が、HTMLの$importsに自動的に展開されますので、このControlで新たに必要になるJava ScriptやCSSを設定します。</dd>
</dl>

<dl>
<dd>この様に、Java Scriptと連携するControlが容易に作成できる事が判って頂けるとおもいます。</dd>
</dl>
<dl>
<dd>なお、setfields.jsの内部に、greyboxのImage Pathを設定するのですが、現在のServletの使用では、ServletContextからContext Pathが取得できないので、止むを得ず最初のRendering時に、Utility#copyGrayboxJs　Methodでコピーするちょっとトリッキーな方法で仕方なく対応しました。</dd>
</dl>
<dl>
<dd>&nbsp;</dd>

<h3><a name="document" id="document">検索画面の呼び出し
</a></h3>
</dl>
<!--code start-->
<div class="excode"><pre>
<code>
まず、textSelect 変数を定義します。

	private TextFieldSelectId textSelect = 
		new TextFieldSelectId("managerName","managerName");
		
コンストラクタの中で、formにこの変数を代入します。
	form.add(textSelect);
	
onInit メソッドで、ManagerのIｄを定義したFieldを設定すると共に、Manager 検索画面の設定をします。
	public void onInit(){
		textSelect.setIdField(manageid);
		textSelect.setSelectPage("ManagerSelect",
				Utility.getFullPagePath(this, ManagerSelectPage.class));
		．．．．．
	}
</code>
</pre></div>
<!--code end-->
<dl>
<dd>上記の設定により、クリックすると ManagerSelect画面が、GrayBoxの内部に表示されます。</dd>
</dl>
<img src="images/manager_select.jpeg" />

<dl>
<dd>&nbsp;</dd>

<h3><a name="document" id="document">検索結果の埋め込み
</a></h3>
</dl>

<dl>
<dd>ここでは、検索結果を呼び出した画面に埋め込む ImageDataSetParentId Controlについて説明します。これは、検索した結果のIdとTextを同時に埋め込むもので、Textのみを埋め込む　ImageDataSetParent ControlをExtendしています。</dd>
</dl>

<dl>
<dd>ImageDataSetParentId Controlは、上記で説明したTextFieldSelectId　Control同様、Java Scriptを使用して、親画面に設定して自分をCloseします</dd>
</dl>
<!--code start-->
<div class="excode"><pre>
<code>
まず、imgSet 変数を定義します。

	private ImageDataSetParentId imgSet = new ImageDataSetParentId("img");	
		
ここでは、検索された結果は FormではなくTableとして（$table）HTML ファイルにレンダリングされます。
コンストラクタの中に、TableのColumnとして、「Sel」列を設定し、Decorator機能を使用して、MangerのIdを
ImageDataSetParentId Componentに設定しています。

		Column column = new Column("Sel");
		column.setDecorator(new Decorator() {
            public String render(Object row, Context context) {
            	Employee employee = (Employee) row;
            	imgSet.setContext(table.getContext());
            	imgSet.setData(employee.getEmpname(),employee.getId().toString());
            	return imgSet.toString();
            }
        });
</code>
</pre></div>
<!--code end-->

<dl>
<dd>このTableの設定が容易なのに、高機能な点は Clickの特筆すべけ特徴だと思います</dd>
</dl>

<ul>

<li><a href="employee_list.html">employee Listサンプル</a></li>
  	<li><a href="index.html">S2Click Home</a></li>
    <li><a href="sample.html">Sampleを見てみよう</a></li>
  </ul>
<!-- document end -->
<!-- don't edit start --></td><td width="14"><img src="images/spacer.gif" alt="" height="14" width="14" /></td></tr><tr><td width="14"><img src="images/spacer.gif" alt="" height="30" width="14" /></td><td width="766"><img src="images/spacer.gif" alt="" height="30" width="592" /></td></tr><tr><td width="14"><img src="images/spacer.gif" alt="" height="14" width="14" /></td><td class="copyright" width="766">Copyright&copy;
2004-2005, The Seasar Foundation and the others. All rights reserved.</td>
</tr></tbody></table></td><td class="backright" align="left" valign="top">&nbsp;</td>
</tr><tr><td class="backunder" align="left" height="16" valign="top" width="780">&nbsp;</td>
<td class="backcorner" align="left" height="16" valign="top">&nbsp;</td>
</tr></tbody></table><!-- don't edit end --></body></html>