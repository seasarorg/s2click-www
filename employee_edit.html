<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja"><head><!-- don't edit start --><title>S2Click-Employee Edit</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="Content-Style-Type" content="text/css" /><link href="s2click.css" type="text/css" rel="stylesheet" media="screen" /><link href="seasar_b.css" type="text/css" rel="stylesheet" media="screen" /><link href="seasar_p.css" type="text/css" rel="stylesheet" media="print" /><script src="seasar_b.js" type="text/JavaScript" language="JavaScript">
</script></head>
<body style="direction: ltr;" onload="preload('ja')"><table align="left" border="0" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td align="left" valign="top" width="780"><table class="white" border="0" cellpadding="0" cellspacing="0" width="780">
<tbody><tr><td colspan="7"><img src="images/top01_b.gif" alt="" height="5" width="780" /></td></tr><tr><td><img src="images/top02_b.gif" alt="Seasar" height="117" width="235" /></td><td colspan="3"><img src="images/top03.gif" alt="DI Container with AOP" height="117" width="289" /></td><td colspan="3"><img src="images/spacer.gif" alt="" height="117" width="256" /></td></tr><tr><td rowspan="2"><img src="images/top04.gif" alt="" height="49" width="235" /></td><td><a href="http://www.seasar.org/index.html"><img src="images/menu01_b_ja.gif" alt="" id="menu01" onmouseover="swap(1)" onmouseout="restore(1)" name="menu01" border="0" height="30" width="78" /></a></td><td><a href="http://www.seasar.org/projects.html"><img src="images/menu02_b_ja.gif" alt="" id="menu02" onmouseover="swap(2)" onmouseout="restore(2)" name="menu02" border="0" height="30" width="101" /></a></td><td><a href="http://www.seasar.org/products.html"><img src="images/menu03_b_ja.gif" alt="" id="menu03" onmouseover="swap(3)" onmouseout="restore(3)" name="menu03" border="0" height="30" width="110" /></a></td><td><a href="http://www.seasar.org/resources.html"><img src="images/menu04_b_ja.gif" alt="" id="menu04" onmouseover="swap(4)" onmouseout="restore(4)" name="menu04" border="0" height="30" width="113" /></a></td><td><img src="images/menu05_b_ja.gif" alt="" id="menu05" onmouseover="swap(5)" onmouseout="restore(5)" name="menu05" border="0" height="30" width="109" /></td><td><img src="images/menu06.gif" alt="" height="30" width="34" /></td>
</tr><tr><td colspan="6"><img src="images/spacer.gif" alt="" height="19" width="545" /></td></tr></tbody></table><table class="white" border="0" cellpadding="0" cellspacing="0" width="780"><tbody><tr align="left" valign="top"><td width="14"><img src="images/spacer.gif" alt="" height="14" width="14" /></td><td class="main" width="740"><!-- don't edit end --><!-- document start -->
<dl>
<dd>&nbsp;</dd>

<h3><a name="document" id="document">Employee Edit
</a></h3>
</dl>
<img src="images/edit1.jpeg" />
<dl>
<dd>この画面は、Employeeの新規作成（New）と更新（Edit）の兼用画面で、get時のmode parameterで両者を見分けています。</dd>
</dl>

<dl>
<dd>それでは、更新の処理について説明しましょう。</dd>
</dl>

<!--code start-->
<div class="excode"><pre>
<code>
	public boolean onEditClicked(){
		return process();	
	}
	public boolean process() {
		Employee employee = new Employee();
		form.copyTo(employee);
		if (employee.getDeptid()!=null){
			employee.setDeptName(CommonLogic.getDeptNameByDeptId(employee.getDeptid()));
		}
		if (form.isValid()) {
			if (checkEmpno(employee)==false){
				form.getField("empno").setError("Duplicate Empno");
				return true;
			}
			Hashtable ht = new Hashtable();
			ht.put("mode",hmode.getValue());
			ht.put("employee",employee);
			Utility.setRedirectWithParameter(
        			this, ht,ConfirmPage.class);
        	return false;			
		}
		return true;	
	}
</code>
</pre></div>
<!--code end-->

<dl>
<dd>Employee Entity BeanにDataを入れていますが、「form.copyTo(employee)」を実行するだけでこれが可能なのは、ControlがData Type毎に用意されているのが、大変有効な例だと思います。</dd>
</dl>

<dl>
<dd>Hashtableに、上記 Entity Beanとmodeを設定して、確認画面にRedirectします。ForwardであればParameterの引き継ぎは、HttpServletRequest で出来るのですが、いわゆる PRG パターン（Post, Redirect, Get）でここはやって見ていますので、Utility#setRedirectWithParameter Methodにて、Sessionに、HashtableをSaveしています。</dd>
</dl>
<!--code start-->
<div class="excode"><pre>
<code>
	public static String CreateSeq(){
		return String.valueOf(new Date().getTime());
	}
	
	public static void setRedirectWithParameter(
			Page page, Object parameter, Class pageClass){
		String seq = CreateSeq();
		page.getContext().getSession().
			setAttribute(seq, parameter);
		page.setRedirect(page.getContext().getPagePath(pageClass) 
				+ "?seq=" + seq);		
	}
</code>
</pre></div>
<!--code end-->

<dl>
<dd>&nbsp;</dd>

<h3><a name="document" id="document">確認画面
</a></h3>
<img src="images/confirm.jpeg" />

<dl>
<dd>ここでは、画面にText表示すると同時にHidden FieldにもDataをSetする、TextAndHidden controlを作りました。下記の様に簡単に作成出来ます。</dd>
</dl>

<!--code start-->
<div class="excode"><pre>
<code>
public class TextAndHidden extends Field {
	public TextAndHidden(){
	}
	public TextAndHidden(String name, String value){
		super(name);
		this.setValue(value);
	}
	public TextAndHidden(String name){
		super(name);
	}
	public String getType(){
		return "textAndHidden";
	}
	public String toString(){

        HtmlStringBuffer buffer = new HtmlStringBuffer(96);
        buffer.elementStart("input");
        buffer.appendAttribute("type", "hidden");
        buffer.appendAttribute("name", getName());
        buffer.appendAttribute("id", getId());
        buffer.appendAttribute("value", getValue());
        buffer.elementEnd();
		String output = buffer.toString();      
		buffer = new HtmlStringBuffer(48);
        buffer.elementStart("span");
        if (hasAttributes()) {
            buffer.appendAttributes(getAttributes());
        }
        buffer.closeTag();
		buffer.append(getValue());
		buffer.elementEnd("span");
		return output + buffer.toString();
	}
}
</code>
</pre></div>
<!--code end-->
<dl>
<dd>本来は、これを Data Type毎に用意すれば、form.CopyToですべてCopy出来るのですが、今回はString Type以外は、自分でコードを書きました。</dd>
</dl>


<ul>
  	<li><a href="index.html">S2Click Home</a></li>
    <li><a href="sample.html">Sampleを見てみよう</a></li>
  </ul>
<!-- document end -->
<!-- don't edit start --></td><td width="14"><img src="images/spacer.gif" alt="" height="14" width="14" /></td></tr><tr><td width="14"><img src="images/spacer.gif" alt="" height="30" width="14" /></td><td width="766"><img src="images/spacer.gif" alt="" height="30" width="592" /></td></tr><tr><td width="14"><img src="images/spacer.gif" alt="" height="14" width="14" /></td><td class="copyright" width="766">Copyright&copy;
2004-2005, The Seasar Foundation and the others. All rights reserved.</td>
</tr></tbody></table></td><td class="backright" align="left" valign="top">&nbsp;</td>
</tr><tr><td class="backunder" align="left" height="16" valign="top" width="780">&nbsp;</td>
<td class="backcorner" align="left" height="16" valign="top">&nbsp;</td>
</tr></tbody></table><!-- don't edit end --></body></html>